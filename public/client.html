<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
  <!-- <script src="./socket.io.js"></script> -->

  <script>
    var token;
    var user = {
      email: 'bar3@baz.com',
      password: 'Bar123$CdDAo7662bgbgasdas8'
    };

    login(user, function callback(token) {
      console.log('token = ', token);
      var client = io('https://localhost:3000/', {
        'query': 'token=' + token
      });

      client.on('connect', function(socket) {
        console.log('connected to server.');
        client.emit('otherevent', { my: 'data' });
        client.on('news', function (data) {
          console.log(data);
        });
      });
    });

    function sendRequest(method, url, body, callback) {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open(method,url,true);
      if (method.toLowerCase() !== 'post')
        xmlhttp.send();
      else if (!body)
        return;
      else {
        console.log('setting the header and sending the request');
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xmlhttp.send(JSON.stringify(body));
      }
      xmlhttp.onreadystatechange = function(res) {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
          callback(xmlhttp.responseText);
      };
    }

    function createUserAccount(user, callback) {
      sendRequest('POST', 'https://localhost:3000/user/', {
        email: user.email,
        password: user.password,
        firstname: user.firstname,
        lastname: user.lastname
      }, function cb(res) {
        callback(JSON.parse(res).token);
      });
    }

    function login(user, callback) {
      sendRequest('POST', 'https://localhost:3000/signin', {
        email: user.email,
        password: user.password
      }, function cb(res) {
        callback(JSON.parse(res).token);
      });
    }

  </script>
</body>
</html>